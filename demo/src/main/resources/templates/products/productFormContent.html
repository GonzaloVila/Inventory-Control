<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>

<div th:fragment="productFormContent">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800" th:text="${pageTitle}"></h1>
        <a th:href="@{/web/products}" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm">
            <i class="fas fa-arrow-left fa-sm text-white-50"></i> Volver a la Lista
        </a>
    </div>

    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${successMessage}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${errorMessage}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div th:if="${#fields.hasErrors()}" class="alert alert-danger alert-dismissible fade show" role="alert">
        Hay errores en el formulario. Por favor, corrígelos.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary" th:text="${pageTitle}"></h6>
        </div>
        <div class="card-body">
            <form th:action="${product.id == null ? '/web/products/add' : '/web/products/update/' + product.id}"
                  th:object="${product}" method="post">

                <div class="form-group">
                    <label for="name">Nombre:</label>
                    <input type="text" class="form-control" id="name" th:field="*{name}" required>
                    <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                </div>

                <div class="form-group">
                    <label for="description">Descripción:</label>
                    <textarea class="form-control" id="description" th:field="*{description}" rows="3"></textarea>
                    <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                </div>

                <div class="form-group">
                    <label for="stock">Stock:</label>
                    <input type="number" class="form-control" id="stock" th:field="*{stock}" required min="0">
                    <div class="text-danger" th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"></div>
                </div>

                <div class="form-group">
                    <label for="price">Precio:</label>
                    <input type="number" class="form-control" id="price" th:field="*{price}" step="0.01" required min="0.01">
                    <div class="text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
                </div>

                <div class="form-group">
                    <label for="category">Categoría:</label>
                    <select class="form-control" id="category" th:field="*{category.id}" required>
                        <option value="">-- Seleccione una Categoría --</option>
                        <option th:each="cat : ${categories}"
                                th:value="${cat.id}"
                                th:text="${cat.name}"
                                th:selected="${product.category != null and product.category.id == cat.id}"></option>
                    </select>
                    <div class="text-danger" th:if="${#fields.hasErrors('category')}" th:errors="*{category.id}"></div>
                </div>

                <div class="form-group">
                    <label for="provider">Proveedor:</label>
                    <select class="form-control" id="provider" th:field="*{provider.id}" required>
                        <option value="">-- Seleccione un Proveedor --</option>
                        <option th:each="prov : ${providers}"
                                th:value="${prov.id}"
                                th:text="${prov.name}"
                                th:selected="${product.provider != null and product.provider.id == prov.id}"></option>
                    </select>
                    <div class="text-danger" th:if="${#fields.hasErrors('provider')}" th:errors="*{provider.id}"></div>
                </div>

                <div class="form-group" th:if="${product.id != null}">
                    <label for="isActive">Activo:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="isActive" th:field="*{active}">
                        <label class="form-check-label" for="isActive">Marcar si el producto está activo</label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Guardar Producto</button>
            </form>
        </div>
    </div>
</div>

</body>
</html>